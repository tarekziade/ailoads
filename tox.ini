[tox]
downloadcache = {toxworkdir}/cache/
envlist = py312,py311,py310,py39,py38,ruff,docs,pypy3

[testenv:py311]
passenv =
    GITHUB_ACTIONS
    GITHUB_TOKEN
commands=
  poetry update
  poetry install -v
  poetry run pytest --random-order-bucket=global --cov-report= --cov-config .coveragerc --cov molotov molotov/tests
  - coverage combine
  - coverage report -m
  - coveralls


[testenv]
passenv =
    GITHUB_ACTIONS
    GITHUB_TOKEN
deps =
  poetry
whitelist_externals = poetry
commands =
    poetry update
    poetry install -v
    poetry run pytest --random-order-bucket=global -sv molotov/tests

[testenv:ruff]
commands = ruff molotov

[testenv:docs]
deps =
    -rrequirements.txt
    sphinx
    -rdocs-requirements.txt
commands=
    sphinx-build -W -b html docs/source docs/build

[gh-actions]
python =
    3.8: py38
    3.9: py39
    3.10: py310, flake8, docs
    3.11: py311, flake8, docs
    3.12.0-beta.3: py312, flake8, docs
    pypy-3.8: pypy3
    pypy-3.9: pypy3
